## Kafka 파티션

토픽은 여러개의 파티션으로 나뉘고 각 파티션은 독립적으로 데이터를 처리한다.  
해다아 파티션을 통해 데이터를 병렬로 처리할 수 있으며, 파티션은 브로커에 분산되어 저장된다.  

각 파티션은 레코드의 순서를 보장하며, 레코드는 파티션 내에서만 순서가 보장된다.  

## 컨슈머 그룹

컨슈머 그룹은 토픽의 파티션을 분산하여 처리한다.  
하나의 토픽은 여러 컨슈머 그룹이 구독할 수 있으며, 컨슈머 그룹 내에서는 각 컨슈머가 특정 파티션을 처리한다.  

예를들어 하나의 토픽을 3개의 컨슈머 그룹이 구독하고있다면  
토픽에 메시지가 발행 되면 3개의 컨슈머 그룹이 각각 메시지를 처리한다.

Ex) `주문` 토픽에 메시지 발행 - `알림` 컨슈머그룹, `로그` 컨슈머그룹, `통계` 컨슈머그룹이 메시지를 처리한다.

## Concurrency

스프링 카프카에서 컨슈머를 구현할 때 concurrency를 설정할 수 있다.
    
```java
@KafkaListener(topics = "topic", groupId = "group", concurrency = "3")
public void listen(String message) {
    // process message
}
```
    
위와 같이 concurrency를 설정하면 3개의 스레드가 생성되어 메시지를 처리한다.  
이때 해당 수치를 잘 설정해야 컨슈머의 성능을 최적화할 수 있고  
일반적으로 파티션의 개수보다 작은 수치로 설정하는 것이 좋다.  

6개의 파티션 : 3개의 컨슈머 -> 1개의 컨슈머가 2개의 파티션을 처리  
6개의 파티션 : 6개의 컨슈머 -> 1개의 컨슈머가 1개의 파티션을 처리  
3개의 파티션 : 6개의 컨슈머 -> 1개의 컨슈머가 1개의 파티션을 처리, 3개의 컨슈머가 놀게 된다.
